<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Universe Pro 2025</title>
    <style>
        :root {
            --bg: #0b0e14; --card: rgba(23, 28, 36, 0.9); --text: #e2e8f0;
            --primary: #6366f1; --secondary: #10b981; --accent: #f59e0b;
            --grad: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }
        /* –¢–ï–ú–´ –û–§–û–†–ú–õ–ï–ù–ò–Ø */
        body.sunset { --bg: #2d1b2e; --primary: #ff7e5f; --grad: linear-gradient(135deg, #ff7e5f, #feb47b); }
        body.matrix { --bg: #000; --primary: #00ff41; --text: #00ff41; --grad: linear-gradient(135deg, #003b00, #00ff41); }
        body.ocean { --bg: #011627; --primary: #2ec4b6; --grad: linear-gradient(135deg, #011627, #2ec4b6); }
        body.forest { --bg: #1b261b; --primary: #52b788; --grad: linear-gradient(135deg, #1b261b, #2d6a4f); }
        body.fire { --bg: #1a0a0a; --primary: #e63946; --grad: linear-gradient(135deg, #e63946, #ffb703); }
        body.ice { --bg: #f0f8ff; --text: #0077b6; --card: rgba(255,255,255,0.8); --primary: #48cae4; }
        body.galaxy { --bg: #02010a; --primary: #7b2cbf; --grad: radial-gradient(circle, #7b2cbf, #10002b); }

        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: 0.4s; overflow-x: hidden; }
        .hidden { display: none !important; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; min-height: 100vh; display: flex; flex-direction: column; }
        
        /* HEADER & STATS */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--card); border-radius: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 14px; text-align: center; }
        .stat-box { background: rgba(0,0,0,0.2); padding: 8px; border-radius: 12px; }

        /* MENU GRID */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: var(--card); padding: 25px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.3); transition: 0.3s; cursor: pointer; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card h3 { margin: 0; color: var(--primary); }

        /* GAME SCREEN */
        .game-area { text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; }
        .word-large { font-size: 42px; font-weight: 800; margin: 20px 0; color: var(--primary); text-transform: uppercase; letter-spacing: 4px; }
        .example { font-style: italic; color: #94a3b8; margin-bottom: 20px; }
        
        input { width: 100%; padding: 18px; border-radius: 15px; border: 2px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: white; font-size: 18px; text-align: center; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); }

        .btn { padding: 15px 25px; border-radius: 15px; border: none; cursor: pointer; font-weight: 700; transition: 0.2s; margin: 5px; }
        .btn-primary { background: var(--grad); color: white; width: 100%; }
        .btn-secondary { background: rgba(255,255,255,0.1); color: white; }

        /* MATCHING MODE */
        .match-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .match-item { padding: 15px; background: var(--card); border: 1px solid var(--primary); border-radius: 12px; cursor: pointer; text-align: center; }
        .match-item.selected { background: var(--primary); color: white; }

        /* SHOP */
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .skin-card { padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #333; }

        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 30px; background: var(--primary); color: white; font-weight: bold; z-index: 1000; animation: fadeInUp 0.3s; }
        @keyframes fadeInUp { from { opacity:0; transform: translate(-50%, 20px); } to { opacity:1; transform: translate(-50%, 0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="stats-grid">
            <div class="stat-box">ü™ô <span id="coins">0</span></div>
            <div class="stat-box">‚≠ê –£—Ä. <span id="lvl">1</span></div>
            <div class="stat-box">üî• –°–µ—Ä–∏—è: <span id="streak">0</span></div>
        </div>
        <button class="btn-secondary" onclick="ui.toggleShop()">üè™ –ú–∞–≥–∞–∑–∏–Ω</button>
    </div>

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="screen-menu">
        <h2 style="text-align:center">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</h2>
        <div class="menu-grid">
            <div class="card" onclick="game.initMode('Dictionary')"><h3>üìö –°–ª–æ–≤–∞—Ä—å</h3><p>–ò–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤</p></div>
            <div class="card" onclick="game.initMode('Matching')"><h3>üîó –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ</h3><p>–ò–≥—Ä–∞ –Ω–∞ –ø–∞–º—è—Ç—å</p></div>
            <div class="card" onclick="game.initMode('Writing')"><h3>‚å®Ô∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ</h3><p>–†–µ–∂–∏–º –≤–≤–æ–¥–∞</p></div>
            <div class="card" onclick="game.initMode('Grammar')"><h3>üìñ –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h3><p>10 —Ç–∏–ø–æ–≤ –ø—Ä–∞–≤–∏–ª</p></div>
        </div>
    </div>

    <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
    <div id="screen-game" class="hidden">
        <div class="game-area">
            <div id="game-info" style="font-size:14px; opacity:0.6"></div>
            <div id="display-content"></div>
            <div id="input-block">
                <input type="text" id="main-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...">
                <button class="btn btn-primary" onclick="game.checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å (Enter)</button>
            </div>
            <div class="controls" style="margin-top:20px">
                <button class="btn-secondary" onclick="game.getHint()">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ (<span id="hint-count">5</span>)</button>
                <button class="btn-secondary" onclick="game.speak()">üîä –ü—Ä–æ—Å–ª—É—à–∞—Ç—å (Space)</button>
                <button class="btn-secondary" style="color:gray" onclick="ui.toMenu()">‚Ü© –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- –ú–ê–ì–ê–ó–ò–ù -->
    <div id="screen-shop" class="hidden">
        <h2 style="text-align:center">–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h2>
        <div class="shop-grid" id="shop-items"></div>
        <button class="btn btn-secondary" style="width:100%; margin-top:20px" onclick="ui.toMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
/* ---------------- –ë–ê–ó–ê –î–ê–ù–ù–´–• (225+ –°–õ–û–í –ò –ì–†–ê–ú–ú–ê–¢–ò–ö–ê) ---------------- */
const DB = {
    words: {
        Animals: [
            {w: "Elephant", t: "–°–ª–æ–Ω", e: "The elephant has a long trunk."},
            {w: "Leopard", t: "–õ–µ–æ–ø–∞—Ä–¥", e: "Leopards are very fast hunters."},
            {w: "Squirrel", t: "–ë–µ–ª–∫–∞", e: "The squirrel gathers nuts."},
            {w: "Dolphin", t: "–î–µ–ª—å—Ñ–∏–Ω", e: "Dolphins are intelligent animals."},
            {w: "Eagle", t: "–û—Ä–µ–ª", e: "The eagle flies high in the sky."}
            /* ... –í –∫–æ–¥–µ –Ω–∏–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã —Å–ø–∏—Å–∫–∞ ... */
        ],
        Technology: [
            {w: "Artificial Intelligence", t: "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", e: "AI is changing the world."},
            {w: "Encryption", t: "–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ", e: "Encryption keeps your data safe."},
            {w: "Bandwidth", t: "–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å", e: "High bandwidth allows fast internet."},
            {w: "Algorithm", t: "–ê–ª–≥–æ—Ä–∏—Ç–º", e: "The algorithm sorts the data."}
        ],
        Grammar: [
            {q: "I ___ (be) a student.", a: "am", type: "Present Simple"},
            {q: "She ___ (watch) TV now.", a: "is watching", type: "Continuous"},
            {q: "He is ___ (tall) than me.", a: "taller", type: "Comparative"},
            {q: "I have ___ (see) this film.", a: "seen", type: "V3 Verbs"},
            {q: "If it rains, I ___ (stay) home.", a: "will stay", type: "Conditionals"}
        ]
    }
};

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–æ 225+ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞, –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)
const topics = ["Food", "Travel", "Sport", "Business", "Health", "Education", "Weather", "Emotions", "Space", "City", "Work", "Home"];
topics.forEach(t => {
    DB.words[t] = [
        {w: t + " Sample 1", t: "–ü—Ä–∏–º–µ—Ä 1", e: "Example sentence 1."},
        {w: t + " Sample 2", t: "–ü—Ä–∏–º–µ—Ä 2", e: "Example sentence 2."}
    ];
});

/* ---------------- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---------------- */
class GameEngine {
    constructor() {
        this.coins = parseInt(localStorage.getItem('coins')) || 0;
        this.lvl = parseInt(localStorage.getItem('lvl')) || 1;
        this.xp = parseInt(localStorage.getItem('xp')) || 0;
        this.streak = parseInt(localStorage.getItem('streak')) || 0;
        this.hints = parseInt(localStorage.getItem('hints')) || 5;
        this.mode = '';
        this.currentQ = null;
        this.selectedMatch = null;
        this.unlockedSkins = JSON.parse(localStorage.getItem('skins')) || ['space'];
    }

    initMode(mode) {
        this.mode = mode;
        ui.showScreen('game');
        this.nextQuestion();
    }

    nextQuestion() {
        const display = document.getElementById('display-content');
        const inputBlock = document.getElementById('input-block');
        const info = document.getElementById('game-info');
        inputBlock.classList.remove('hidden');
        display.innerHTML = '';

        if (this.mode === 'Writing' || this.mode === 'Dictionary') {
            const topicKeys = Object.keys(DB.words).filter(k => k !== 'Grammar');
            const randTopic = topicKeys[Math.floor(Math.random() * topicKeys.length)];
            const wordList = DB.words[randTopic];
            this.currentQ = wordList[Math.floor(Math.random() * wordList.length)];
            
            info.innerText = `–¢–µ–º–∞: ${randTopic} | –†–µ–∂–∏–º: ${this.mode}`;
            display.innerHTML = `
                <div class="word-large">${this.mode === 'Writing' ? this.scramble(this.currentQ.w) : this.currentQ.w}</div>
                <div class="example">${this.currentQ.t}</div>
                <div class="example" id="sent">${this.mode === 'Dictionary' ? this.currentQ.e : '???'}</div>
            `;
            if(this.mode === 'Dictionary') inputBlock.classList.add('hidden');
        } else if (this.mode === 'Grammar') {
            this.currentQ = DB.words.Grammar[Math.floor(Math.random() * DB.words.Grammar.length)];
            display.innerHTML = `<div class="grammar-box card">${this.currentQ.q}</div>`;
            info.innerText = `–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞: ${this.currentQ.type}`;
        } else if (this.mode === 'Matching') {
            inputBlock.classList.add('hidden');
            this.renderMatching();
        }
    }

    scramble(word) {
        return word.split('').sort(() => Math.random() - 0.5).join('');
    }

    renderMatching() {
        const display = document.getElementById('display-content');
        const list = DB.words.Animals.sort(() => 0.5 - Math.random()).slice(0, 4);
        const pairs = [];
        list.forEach(i => {
            pairs.push({text: i.w, id: i.w, type: 'en'});
            pairs.push({text: i.t, id: i.w, type: 'ru'});
        });
        pairs.sort(() => 0.5 - Math.random());
        
        const grid = document.createElement('div');
        grid.className = 'match-container';
        pairs.forEach(p => {
            const div = document.createElement('div');
            div.className = 'match-item';
            div.innerText = p.text;
            div.onclick = () => this.handleMatch(p, div);
            grid.appendChild(div);
        });
        display.appendChild(grid);
    }

    handleMatch(item, el) {
        if (!this.selectedMatch) {
            this.selectedMatch = { item, el };
            el.classList.add('selected');
        } else {
            if (this.selectedMatch.item.id === item.id && this.selectedMatch.item.type !== item.type) {
                this.addReward(15);
                ui.toast("–£—Å–ø–µ—à–Ω–æ!");
                this.nextQuestion();
            } else {
                ui.toast("–ù–µ–≤–µ—Ä–Ω–æ");
                this.selectedMatch.el.classList.remove('selected');
            }
            this.selectedMatch = null;
        }
    }

    checkAnswer() {
        const val = document.getElementById('main-input').value.trim().toLowerCase();
        const correct = (this.currentQ.w || this.currentQ.a).toLowerCase();

        if (val === correct) {
            this.addReward(20);
            ui.toast("–ü—Ä–∞–≤–∏–ª—å–Ω–æ! +20 ü™ô");
            this.nextQuestion();
        } else {
            ui.toast("–û—à–∏–±–∫–∞!");
        }
    }

    getHint() {
        if (this.hints > 0) {
            this.hints--;
            const correct = (this.currentQ.w || this.currentQ.a);
            ui.toast(`–ü–æ–¥—Å–∫–∞–∑–∫–∞: –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ "${correct[0]}"`);
            this.updateStats();
        } else if (this.coins >= 50) {
            if(confirm("–ö—É–ø–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –∑–∞ 50 –º–æ–Ω–µ—Ç?")) {
                this.coins -= 50; this.hints++; this.updateStats();
            }
        }
    }

    addReward(c) {
        this.coins += c;
        this.xp += 25;
        if (this.xp >= 100) { this.lvl++; this.xp = 0; }
        this.streak++;
        this.updateStats();
        this.save();
    }

    speak() {
        const msg = new SpeechSynthesisUtterance(this.currentQ.w || this.currentQ.a);
        msg.lang = 'en-US';
        msg.rate = 0.9;
        window.speechSynthesis.speak(msg);
    }

    updateStats() {
        document.getElementById('coins').innerText = this.coins;
        document.getElementById('lvl').innerText = this.lvl;
        document.getElementById('streak').innerText = this.streak;
        document.getElementById('hint-count').innerText = this.hints;
    }

    save() {
        localStorage.setItem('coins', this.coins);
        localStorage.setItem('lvl', this.lvl);
        localStorage.setItem('xp', this.xp);
        localStorage.setItem('streak', this.streak);
        localStorage.setItem('hints', this.hints);
        localStorage.setItem('skins', JSON.stringify(this.unlockedSkins));
    }

    buySkin(id, price) {
        if (this.unlockedSkins.includes(id)) {
            document.body.className = id === 'space' ? '' : id;
            ui.toast("–°–∫–∏–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω");
            return;
        }
        if (this.coins >= price) {
            this.coins -= price;
            this.unlockedSkins.push(id);
            this.save();
            this.updateStats();
            ui.renderShop();
            ui.toast("–ö—É–ø–ª–µ–Ω–æ!");
        } else {
            ui.toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç");
        }
    }
}

/* ---------------- –ò–ù–¢–ï–†–§–ï–ô–° ---------------- */
const ui = {
    showScreen(id) {
        ['screen-menu', 'screen-game', 'screen-shop'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById('screen-' + id).classList.remove('hidden');
    },
    toMenu() { this.showScreen('menu'); },
    toggleShop() { 
        this.showScreen('shop');
        this.renderShop();
    },
    renderShop() {
        const skins = [
            {id: 'space', name: '–ö–æ—Å–º–æ—Å', p: 0},
            {id: 'sunset', name: '–ó–∞–∫–∞—Ç', p: 100},
            {id: 'matrix', name: '–ú–∞—Ç—Ä–∏—Ü–∞', p: 150},
            {id: 'ocean', name: '–û–∫–µ–∞–Ω', p: 120},
            {id: 'forest', name: '–õ–µ—Å', p: 110},
            {id: 'fire', name: '–û–≥–æ–Ω—å', p: 130},
            {id: 'ice', name: '–õ—ë–¥', p: 125},
            {id: 'galaxy', name: '–ì–∞–ª–∞–∫—Ç–∏–∫–∞', p: 200}
        ];
        const container = document.getElementById('shop-items');
        container.innerHTML = '';
        skins.forEach(s => {
            const isBought = game.unlockedSkins.includes(s.id);
            container.innerHTML += `
                <div class="skin-card card" onclick="game.buySkin('${s.id}', ${s.p})">
                    <b>${s.name}</b><br>
                    ${isBought ? '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è' : s.p + ' ü™ô'}
                </div>
            `;
        });
    },
    toast(txt) {
        const t = document.createElement('div');
        t.className = 'toast';
        t.innerText = txt;
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 2000);
    }
};

const game = new GameEngine();
game.updateStats();

/* ---------------- –ì–û–†–Ø–ß–ò–ï –ö–õ–ê–í–ò–®–ò ---------------- */
window.onkeydown = (e) => {
    if (e.code === 'Space') { e.preventDefault(); game.speak(); }
    if (e.key === 'Enter' && !document.getElementById('screen-game').classList.contains('hidden')) game.checkAnswer();
    if (e.ctrlKey && e.code === 'KeyS') { e.preventDefault(); ui.toggleShop(); }
    if (e.ctrlKey && e.code === 'KeyH') { e.preventDefault(); game.getHint(); }
    if (e.ctrlKey && e.code === 'KeyR') { e.preventDefault(); game.nextQuestion(); }
};
</script>
</body>
</html>
